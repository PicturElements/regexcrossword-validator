function a(a){for(const c of a.checkers)b(a,c);return a}function b(a,b){let c="",d=!0;for(const[e,f]of b.indices){const b=a.rows[e][f].input.value;if(!b){d=!1;break}c+=b}b.clue.style=d&&!b.regex.test(c)?"background: #da3826; color: white; border-radius: 3px":""}function c(a){const b={wrapper:a,type:a.classList.contains("puzzle-hexagonal")?"hexagonal":"grid",rows:[],checkers:[]};switch(b.type){case"grid":return d(b,a);case"hexagonal":return e(b,a);}return b}function d(a,b){const c=b.querySelectorAll("thead th + th"),d=b.querySelectorAll("tfoot th + th");return a.rows=[...b.querySelectorAll("tbody tr")].map((a,b,e)=>{const f=[...a.querySelectorAll("td")];return f.map((g,h)=>{const i={row:a,cell:g,cells:f,input:g.querySelector("input"),clues:{top:null,bottom:null,left:null,right:null}};return b||(i.clues.top=c[h]||null),b==e.length-1&&(i.clues.bottom=d[h]||null),h||(i.clues.left=g.previousElementSibling||null),h==f.length-1&&(i.clues.right=g.nextElementSibling||null),i})}),a.checkers=f(a),a}function e(a,b){return a.rows=[...b.querySelectorAll(".row")].map(a=>{const b=[...a.children];return b.map(c=>({row:a,cell:c,cells:b,input:c.querySelector("input")}))}),a.checkers=g(a),a}function f(a){if(!a.rows.length)return[];const b=[],c=a.rows.length;return a.rows.forEach((a,c)=>{const d=a[0],e=d.clues.left,f=e&&e.textContent.trim();f&&b.push({clue:e,value:f,regex:j(f),indices:a.map((a,b)=>[c,b])});const g=a[a.length-1],h=g.clues.right,i=h&&h.textContent.trim();i&&b.push({clue:h,value:i,regex:j(i),indices:a.map((a,b)=>[c,b])})}),a.rows[0].forEach((c,d)=>{const e=c.clues.top,f=e&&e.textContent.trim();f&&b.push({clue:e,value:f,regex:j(f),indices:a.rows.map((a,b)=>[b,d])})}),a.rows[c-1].forEach((c,d)=>{const e=c.clues.bottom,f=e&&e.textContent.trim();f&&b.push({clue:e,value:f,regex:j(f),indices:a.rows.map((a,b)=>[b,d])})}),b}function g(a){if(!a.rows.length)return[];const b=[],c=a.rows.length;a.rows.forEach((a,c)=>{const d=a[0].cell,e=d.querySelector(".clue-left input");e&&e.value&&b.push({clue:e,value:e.value,regex:j(e.value),indices:a.map((a,b)=>[c,b])})}),a.rows[0].forEach(({cell:c},d)=>{const e=c.querySelector(".clue-top input");e&&e.value&&b.push({clue:e,value:e.value,regex:j(e.value),indices:h(a,0,d)})});for(let d=1,e=Math.ceil(c/2);d<e;d++){const c=a.rows[d],e=c.length-1,f=c[e].cell.querySelector(".clue-top input");if(!f||!f.value)break;b.push({clue:f,value:f.value,regex:j(f.value),indices:h(a,d,e)})}a.rows[c-1].forEach(({cell:d},e)=>{const f=d.querySelector(".clue-bottom input");f&&f.value&&b.push({clue:f,value:f.value,regex:j(f.value),indices:i(a,c-1,e)})});for(let d=c-2,e=Math.floor(c/2);d>=e;d--){const c=a.rows[d],e=c.length-1,f=c[e].cell.querySelector(".clue-bottom input");if(!f||!f.value)break;b.push({clue:f,value:f.value,regex:j(f.value),indices:i(a,d,e)})}return b}function h(a,b,c){const d=[],e=a.rows,f=e.length,g=Math.ceil(f/2);let h=c;for(let f=b,i=e.length;f<i&&(f>=g&&h--,!(0>h));f++)d.push([f,h]);return d}function i(a,b,c){const d=[],e=a.rows,f=e.length,g=Math.floor(f/2);let h=c;for(let e=b;0<=e&&(e<g&&h--,!(0>h));e--)d.push([e,h]);return d}function j(a){return new RegExp(`^${a}$`,"i")}(function(){if(window[Symbol.for("runtime")]){const b=window[Symbol.for("runtime")];return void(b.puzzle&&a(b.puzzle))}const b=()=>{e.addEventListener("input",b=>{b.target.value&&a(f)}),e.addEventListener("change",()=>a(f))},d=prompt("Choose an operating mode:\nclick - Validate when the bookmarklet is clicked\nlive - track edits and validate in real-time","click");if(null==d)return;if("live"!=d&&"click"!=d)return alert(`Invalid operating mode '${d}'`);let e=document.querySelector("form.puzzle"),f=e&&c(e)||null,g={puzzle:f};const h=new MutationObserver(()=>{const h=document.querySelector("form.puzzle");h&&h!=e&&(e=h,f=c(h),g.puzzle=f,"live"==d&&(a(f),b()))});h.observe(document.body,{subtree:!0,childList:!0}),f&&a(f),"live"==d&&b(),window[Symbol.for("runtime")]=g})()
